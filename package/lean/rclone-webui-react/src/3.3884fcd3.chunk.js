(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{807:function(e,a,t){"use strict";t.r(a);var n=t(38),s=t(39),r=t(90),o=t(89),c=t(91),i=t(0),l=t.n(i),d=t(420),u=t(138),m=t(88),p=t(785),h=t(449),g=t(450),f=t(451),w=t(786),E=t(452),y=t(453),b=t(424),v=t(436),N=t(430),P=t(140),A=t(2),S=function(e,a){return function(t){t({type:A.a,payload:{authKey:btoa(e+":"+a)}}),t({type:A.b})}},C=function(e){return function(a){a({type:A.e,payload:{ipAddress:e}}),a({type:A.b})}},x=t(104),k=t(67);function I(e){var a=document.location.href,t=a.split("?");if(t.length>=2){for(var n=t.shift(),s=t.join("?"),r=encodeURIComponent(e)+"=",o=s.split(/[&;]/g),c=o.length;c-- >0;)-1!==o[c].lastIndexOf(r,0)&&o.splice(c,1);a=(a=o.length>0?n+"?"+o.join("&"):n).replace(window.location.origin,""),window.history.pushState("",document.title,a)}return a}var L=function(e){function a(e){var t;Object(n.a)(this,a),(t=Object(r.a)(this,Object(o.a)(a).call(this,e))).changeUserName=function(e){t.setState({username:e.target.value,connectionSuccess:!1})},t.changePassword=function(e){t.setState({password:e.target.value,connectionSuccess:!1})},t.changeIPAddress=function(e){t.setState({ipAddress:e.target.value,connectionSuccess:!1})},t.redirectToDashboard=function(){t.props.history.push("/dashboard")},t.onSubmit=function(e){e&&e.preventDefault();var a=t.state,n=a.ipAddress,s=a.username,r=a.password;Promise.all([S(s,r),C(n)]).then(function(){t.redirectToDashboard()})},t.checkConnection=function(e){e.preventDefault();var a=t.state,n=a.ipAddress,s=a.username,r=a.password,o=t.props,c=o.changeUserNamePassword,i=o.changeIPAddress;Promise.all([c(s,r),i(n)]).then(function(){x.a.post(k.a.noopAuth).then(function(e){console.log("连接成功"),t.setState({connectionSuccess:!0,error:""})},function(e){console.log(e),t.setState({connectionSuccess:!1,error:"连接错误。请检查用户名密码并验证rclone是否在指定的IP上工作。"})})})};var s=window.location.href.split("#/")[0];return-1!==s.indexOf("?")&&(s=window.location.href.split("?")[0]),t.state={username:"",password:"",ipAddress:s,connectionSuccess:!1,error:""},t}return Object(c.a)(a,e),Object(s.a)(a,[{key:"componentDidMount",value:function(){localStorage.clear(),this.props.signOut();var e=window.location.href,a=new URL(e),t=a.searchParams.get("login_token"),n=this.state.ipAddress;a.searchParams.get("ip_address")&&(n=a.searchParams.get("ip_address")),t&&(Promise.all([this.props.changeAuthKey(t),this.props.changeIPAddress(n)]),I("login_token"),I("ip_address"),this.redirectToDashboard())}},{key:"render",value:function(){var e=this.state,a=e.username,t=e.password,n=e.ipAddress,s=e.connectionSuccess,r=e.error;return l.a.createElement("div",{className:"app flex-row align-items-center","data-test":"loginComponent"},l.a.createElement(d.a,null,l.a.createElement(u.a,{className:"justify-content-center"},l.a.createElement(m.a,{md:"8"},l.a.createElement(p.a,null,l.a.createElement(h.a,{className:"p-4"},l.a.createElement(g.a,null,l.a.createElement(f.a,{onSubmit:this.onSubmit},l.a.createElement("h1",null,"登录"),l.a.createElement("p",{className:"text-muted"},"登录你的账户"),r&&l.a.createElement(w.a,{color:"danger",children:r}),s&&l.a.createElement(w.a,{color:"success",children:"连接成功。现在可以登录了。"}),l.a.createElement(E.a,{className:"mb-3"},l.a.createElement(y.a,{addonType:"prepend"},l.a.createElement(b.a,null,l.a.createElement("i",{className:"icon-user"}))),l.a.createElement(v.a,{type:"text",placeholder:"IP地址/URL",autoComplete:"ipAddress",onChange:this.changeIPAddress,value:n,"data-testid":""})),l.a.createElement(E.a,{className:"mb-3"},l.a.createElement(y.a,{addonType:"prepend"},l.a.createElement(b.a,null,l.a.createElement("i",{className:"icon-user"}))),l.a.createElement(v.a,{type:"text",placeholder:"用户名",autoComplete:"username","data-testid":"LoginForm-userName",onChange:this.changeUserName,value:a})),l.a.createElement(E.a,{className:"mb-4"},l.a.createElement(y.a,{addonType:"prepend"},l.a.createElement(b.a,null,l.a.createElement("i",{className:"icon-lock"}))),l.a.createElement(v.a,{type:"password",placeholder:"密码","data-testid":"LoginForm-password",autoComplete:"current-password",onChange:this.changePassword,value:t})),l.a.createElement(u.a,null,l.a.createElement(m.a,{xs:"6"},l.a.createElement(N.a,{color:"primary",className:"px-4","data-testid":"LoginForm-BtnLogin",disabled:!s},"登录")),l.a.createElement(m.a,{xs:"6",className:"text-right"},l.a.createElement(N.a,{onClick:this.checkConnection,color:"primary","data-testid":"LoginForm-BtnVerify",className:"px-4"},"验证")))))),l.a.createElement(h.a,{className:"text-white bg-primary py-5 d-md-down-none",style:{width:"44%"}},l.a.createElement(g.a,{className:"text-center"},l.a.createElement("div",null))))))))}}]),a}(i.Component);a.default=Object(P.b)(null,{signOut:function(){return function(e){e({type:A.E})}},changeUserNamePassword:S,changeIPAddress:C,changeAuthKey:function(e){return function(a){a({type:A.a,payload:{authKey:e}}),a({type:A.b})}}})(L)}}]);
//# sourceMappingURL=3.3884fcd3.chunk.js.map